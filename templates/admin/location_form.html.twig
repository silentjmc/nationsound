{% extends '@!EasyAdmin/crud/form_theme.html.twig' %}

{% block form_start %}
    {{ parent() }}
{% endblock %}

{% block form_end %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>


    <div id="map" style="width: 600px; height: 400px;"></div>

    <script type="text/javascript">
        var mymap = L.map('map').setView([48.6045, 2.3400], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(mymap);

        var currentMarker = null;
        var latitudeField = document.getElementById('Location_latitude');
        var longitudeField = document.getElementById('Location_longitude');
        if (latitudeField && longitudeField && latitudeField.value && longitudeField.value) {
        var initialLatLng = [(latitudeField.value.replace(',', '.')), (longitudeField.value.replace(',', '.'))];
        console.log(initialLatLng);
        currentMarker = L.marker(initialLatLng).addTo(mymap);
        } 

        // Fonction pour ajouter un marqueur à l'endroit cliqué
        function onMapClick(e) {

        if (currentMarker) {
                currentMarker.remove();
        }

            currentMarker = L.marker(e.latlng).addTo(mymap);



            latitudeField.value = e.latlng.lat;
            longitudeField.value = e.latlng.lng;
        }
        mymap.on('click', onMapClick);
        
    </script>
    <div>
        Les champs marqués d'un astérisque (*) sont obligatoires
    </div>
{% endblock %}


