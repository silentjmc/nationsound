<main>
  <div class="mx-6 my-5 md:mx-20 md:my-10">
    <h1 class="font-title text-black text-2xl sm:text-3xl md:text-5xl uppercase font-extrabold text-center pb-2">Programmation</h1>
    <div class="border border-black w-full min-w-52">
      <!-- filter zone -->
      <h2 class="font-title text-black text-center text-lg uppercase">filtres</h2>
      @if(loadingFilters) {
        <div class="flex flex-col md:flex-row justify-around my-3 mx-5 animate-pulse">
          <!-- Loading skeleton for location filter -->
          <div class="w-full md:w-1/4 mb-4 md:mb-0">
            <div class="font-title text-black text-3xl text-center place-content-center w-full font-semibold pb-2">
              <p>Chargement...</p>
            </div>
          </div>
        </div>
      } @else { 
      <div class="flex flex-col md:flex-row justify-around my-3 mx-5"> 
        <!-- location filter -->
        <div>
          <h3 class="font-title">Lieux</h3>
          @for(filter of locationFilters | sortBy:'name' ; track filter.id) {
            <div>
              <input type="checkbox" 
                     [id]="filter.name" 
                     [checked]="filter.isChecked"
                     (change)="onLocationFilterChange(filter)" />
              <label class="mx-2 font-text" [for]="filter.name">{{filter.name}}</label>
            </div>
          }
        </div>
        <!-- event filter -->
        <div>
          <h3 class="font-title">Événements</h3>
          @for(filter of eventFilters | sortBy:'name' ; track filter.id) {
            <div>
              <input type="checkbox" 
                     [id]="filter.name" 
                     [checked]="filter.isChecked"
                     (change)="onEventFilterChange(filter)" />
              <label class="mx-2 font-text" [for]="filter.name">{{filter.name}}</label>
            </div>
          }
        </div>
        <!-- date filter -->
        <div>
          <h3 class="font-title">Dates</h3>
          @for(filter of dateFilters | sortBy:'name' ; track filter.id) {
            <div>
              <input type="checkbox" 
                     [id]="filter.name" 
                     [checked]="filter.isChecked"
                     (change)="onDateFilterChange(filter)" />
              <label class="mx-2 font-text" [for]="filter.name">
                <!-- {{filter.name | date:'dd/MM/yyyy'}} -->
                {{filter.name}}
              </label>
            </div>
          }
        </div>
        <!-- time filter -->
        <div>
          <h3 class="font-title">Horaires</h3>
          <div class="flex gap-3 font-text">
            <label for="timeStart" class="mt-1 w-7">De : </label>
            <select id="timeStart" (change)="onTimeStartChange($event)" [value]="timeFiltersStart || ''" class="p-1 w-36">
              <option value="">- indifférent -</option>
              @for(filter of timeFilters | sortBy:'name'; track filter.id) {
                <option [value]="filter.name" [selected]="timeFiltersStart === filter.name">{{filter.name}}</option>
            }
            </select>
          </div>
          <div class="flex gap-3 mt-2 font-text">
            <label for="timeEnd" class="mt-1 w-7">A : </label>
            <select id="timeEnd" (change)="onTimeEndChange($event)"  [value]="timeFiltersEnd || ''" class="p-1 w-36">
              <option value="">- indifférent -</option>
              @for(filter of timeFinalFilters | sortBy:'name'; track filter.id) {
                <option [value]="filter.name" [selected]="timeFiltersEnd === filter.name">{{filter.name}}</option>
            }
            </select>
          </div>
          @if (errorMessage){
            <div  class="text-red-600">
              {{ errorMessage }}
            </div>
          }
        </div>
      </div>
      }
    </div>
    <!-- artists grids -->
    <div class="relative grid grid-cols-1 gap-2 m-1 mt-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 justify-items-center">
      @for(program of (filteredPrograms$ | async); track program.id) {
        @defer (on viewport) {
          <a [routerLink]="['/artist', program.artist.id]">
            <div class=" flex flex-col bg-white rounded-lg border border-gray-200 shadow transition-all duration-300 grayscale hover:grayscale-0 hover:bg-amber-100">
              <div class="overflow flex justify-center items-center">
                <img class="w-full h-full object-cover rounded-t-lg" src="{{ program.artist.thumbnail }}" alt="{{ program.artist.name }}" />
              </div>
              <div class="text-left px-2">
                <h4 class="font-text font-semibold text-gray-700">{{ program.type.type }}</h4>
                @if(program.artist.name.length>20){
                  <h5 class="font-text text-lg leading-tight font-bold tracking-tight text-gray-900">{{ program.artist.name }}</h5>
                } @else {
                  <h5 class="font-text text-xl font-bold tracking-tight text-gray-900">{{ program.artist.name }}</h5>
                }
                <p class="font-text text-base text-gray-700">{{program.date.date | date:'dd/MM/yyyy'}}</p>
                <p class="font-text text-base text-gray-700">{{program.heure_debut | date:'HH:mm'}} - {{program.heure_fin | date:'HH:mm'}}</p>
                <p class="font-text text-base text-gray-700">{{program.eventLocation.locationName}}</p>
              </div>
            </div>
          </a>
          } 
          @placeholder {
            <div class="w-full h-64 bg-gray-200 animate-pulse rounded-lg"></div>
          }
        }
    </div>
  </div>
</main>